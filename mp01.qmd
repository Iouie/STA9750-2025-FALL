---
title: "PROJECT 1"
---

```
if(!dir.exists(file.path("data", "mp01"))){
    dir.create(file.path("data", "mp01"), showWarnings=FALSE, recursive=TRUE)
}

GLOBAL_TOP_10_FILENAME <- file.path("data", "mp01", "global_top10_alltime.csv")

if(!file.exists(GLOBAL_TOP_10_FILENAME)){
    download.file("https://www.netflix.com/tudum/top10/data/all-weeks-global.tsv", 
                  destfile=GLOBAL_TOP_10_FILENAME)
}

COUNTRY_TOP_10_FILENAME <- file.path("data", "mp01", "country_top10_alltime.csv")

if(!file.exists(COUNTRY_TOP_10_FILENAME)){
    download.file("https://www.netflix.com/tudum/top10/data/all-weeks-countries.tsv", 
                  destfile=COUNTRY_TOP_10_FILENAME)
}

----------

if(!require("tidyverse")) install.packages("tidyverse")
library(readr)
library(dplyr)

GLOBAL_TOP_10 <- read_tsv(GLOBAL_TOP_10_FILENAME)


---------------------


GLOBAL_TOP_10 <- GLOBAL_TOP_10 |> mutate(season_title = if_else(season_title =="N/A", NA, season_title))

COUNTRY_TOP_10 <- read_tsv(COUNTRY_TOP_10_FILENAME, na=c("N/A"))

1) How many different countries does Netflix operate in? (You can use the viewing history as a proxy for countries in which Netflix operates.)

### create new variable to store the unique countries column and their initials. Total: 94

all_countries <- distinct(COUNTRY_TOP_10, country_name, country_iso2)  

2) Which non-English-language film has spent the most cumulative weeks in the global top 10? How many weeks did it spend?

### create new variable to show noneng top 10 shows, only filter category to nonenglish films, select category, show title, and cumulative weeks

non_engtop10 <- GLOBAL_TOP_10 |> filter(category == "Films (Non-English)") |> select(category, show_title, cumulative_weeks_in_top_10) |> arrange(desc(cumulative_weeks_in_top_10)). All Quiet on the Western Front | 23 weeks

3) What is the longest film (English or non-English) to have ever appeared in the Netflix global Top 10? How long is it in minutes?

Note that Netflix does not provide runtime for programs before a certain date, so your answer here may be a bit limited.

longest_film <- GLOBAL_TOP_10 |> select(show_title, category, runtime) |> filter(category == "Films (Non-English)" | category == "Films (English)")|> mutate(runtime_mins = round(runtime * 60)) |> arrange(desc(runtime_mins)) |> distinct(show_title, category, runtime, runtime_mins) 

Pushpa 2: The Rule (Reloaded Version) Runtime: 224mins

4) For each of the four categories, what program has the most total hours of global viewership?

total_weekly_viewers<- GLOBAL_TOP_10 %>% group_by(category) %>% summarise(total = sum(weekly_hours_viewed)) %>% arrange(desc(total))

5) Which TV show had the longest run in a countryâ€™s Top 10? How long was this run and in what country did it occur?

tv_tops <- COUNTRY_TOP_10 |> select(category, show_title, cumulative_weeks_in_top_10,country_name) |> filter(category == "TV") |> distinct(show_title, country_name, .keep_all = TRUE) |> arrange(desc(cumulative_weeks_in_top_10))

Money Heist: Pakistan 127 consecutive weeks

7) What is the total viewership of the TV show Squid Game? Note that there are three seasons total and we are looking for the total number of hours watched across all seasons.

tot_hrs_squgame <- GLOBAL_TOP_10 |> select(season_title, weekly_hours_viewed) |> filter(str_detect(season_title, "Squid Game: Season")) |> summarise(total_hrs = sum(weekly_hours_viewed))

8) The movie Red Notice has a runtime of 1 hour and 58 minutes. Approximately how many views did it receive in 2021? Note that Netflix does not provide the weekly_views values that far back in the past, but you can compute it yourself using the total view time and the runtime.

red_weekly_views <- GLOBAL_TOP_10 |> select(week, show_title, weekly_hours_viewed) |> filter(str_detect(week, "2021"),show_title == "Red Notice") |> summarise(total_wkly_hrs = sum(weekly_hours_viewed)) 

396740000

total weekly hours viewed / 1.97hrs

red_weekly_views <- red_weekly_views / 1.97 = 201390863 total views in 2021

9) How many Films reached Number 1 in the US but did not originally debut there? That is, find films that first appeared on the Top 10 chart at, e.g., Number 4 but then became more popular and eventually hit Number 1? What is the most recent film to pull this off?

us_films <- COUNTRY_TOP_10 |> select(country_iso2,week, show_title, weekly_rank, category) |> filter(country_iso2 == "US", category == "Films") SHOW US FILMS ONLY

us_tops <- us_films %>% group_by(show_title) %>% summarise(debut_rank = weekly_rank[which.min(week)], first_hit_week = min(week[weekly_rank == 1]), hit_no1 = any(weekly_rank == 1)) %>% filter(hit_no1, debut_rank != 1) %>% select(show_title, debut_rank, first_hit_week) |> arrange(desc(first_hit_week))

10) Which TV show/season hit the top 10 in the most countries in its debut week? In how many countries did it chart?


debut <- COUNTRY_TOP_10 %>% filter(category =="TV") %>% group_by(show_title, country_name) %>% summarise(debut_week = min(week), debut_rank = weekly_rank[which.min(week)], .groups="drop" ) %>% group_by(show_title) %>% summarise(countries_in_top_10 = n_distinct(country_name), .groups= "drop") %>% arrange(desc(countries_in_top_10))

```

```{r}
#| include: false
1+1
```
--------------
Last Updated: `r format(Sys.time(), "%A %m %d, %Y at %H:%M%p")`